<head>
  <title>Topcoder Project Service - ES/DB Comparison Report</title>
<script>
function copyFromDB(data) {
  copyFrom(data, 'db')
}
function copyFromES(data) {
  copyFrom(data, 'es')
}
function copyFrom(data, type) {
  var modelName = Object.keys(data)[0]
  var documentId = Object.values(data)[0]
  var text = document.getElementById(type + '_' + modelName + '_' + documentId)
  text.select()
  document.execCommand('copy')
  alert(`Copied ${modelName}: ${documentId} from ${type.toUpperCase() } data`)
}
</script>
</head>

<body>
<h1>Summary</h1>
There are {{ project.meta.totalObjects }} objects with inconsistencies found in {{ project.meta.totalProjects }} projects.
<h1>List</h1>
<h2>Project ({{ project.meta.totalObjects }})</h2>
{{#each project.rootMismatch }}
  <h3>Project - id: {{ @key }} ({{ this.meta.counts }})</h3>
  {{#if this.project.length}}
  <button onclick="copyFromDB({ Project: '{{ @key }}' })">Copy from DB</button>
  <button onclick="copyFromES({ Project: '{{ @key }}' })">Copy from ES</button>
  <p>{{ this.project.length }} mismatches:</p>
  {{/if}}
  <ui>
  {{#each this.project }}
    <li>{{ this.path }}</li>
  {{/each}}
  </ui>

  {{#each this.associations }}
  <h4>{{ @key }} ({{ this.meta.counts }})</h4>
    {{#each this.mismatches }}
      <h5>{{ @../key }} - id: {{ @key }}</h5>
      <button onclick="copyFromDB({ {{ @../key }}: '{{ @key }}' })">Copy from DB</button>
      <button onclick="copyFromES({ {{ @../key }}: '{{ @key }}' })">Copy from ES</button>
      <p>{{ this.length }} mismatches:</p>
      <ui>
      {{#each this }}
        <li>{{ this.path }}</li>
      {{/each}}
      </ui>
    {{/each}}
    {{#each this.dbOnly }}
      <h5>{{ @../key }} - id: {{ this.id }} (1)</h5>
      <button onclick="copyFromDB({ {{ this.modelName }}: '{{ this.id }}' })">Copy from DB</button>
      <p>Found in DB but not in ES.</p>
    {{/each}}

    {{#each this.esOnly }}
      <h5>{{ @../key }} - id: {{ this.id }} (1)</h5>
      <button onclick="copyFromES({ {{ this.modelName }}: '{{ this.id }}' })">Copy from ES</button>
      <p>Found in ES but not in DB.</p>
    {{/each}}
  {{/each}}
{{/each}}

{{#each project.dbOnly }}
<h3>Project - id: {{ this.id }} (1)</h3>
<button onclick="copyFromDB({ Project: '{{ this.id }}' })">Copy from DB</button>
<p>Found in DB but not in ES.</p>
{{/each}}

{{#each project.esOnly }}
<h3>Project - id: {{ this.id }} (1)</h3>
<button onclick="copyFromES({ Project: '{{ this.id }}' })">Copy from ES</button>
<p>Found in ES but not in DB.</p>
{{/each}}

<h1>Data</h1>
{{#each meta.dbCopies }}
<textarea readOnly id="db_{{ this.modelName }}_{{ this.id }}" rows="8" cols="40">
  {{toJSON this.dbCopy }}
</textarea>
{{/each}}
{{#each meta.esCopies }}
<textarea readOnly id="es_{{ this.modelName }}_{{ this.id }}" rows="8" cols="40">
  {{toJSON this.esCopy }}
</textarea>
{{/each}}
</body>
